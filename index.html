<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InvestDash Universal v14</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #020617; --card: #0f172a; --primary: #38bdf8; --accent: #818cf8;
            --success: #10b981; --danger: #fb7185; --text: #f8fafc; --sub: #94a3b8; --border: #1e293b;
        }
        * { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: 0.3s; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* Header & Navigation */
        .header { background: var(--card); padding: 25px; border-radius: 24px; border: 1px solid var(--border); margin-bottom: 15px; }
        .nav-pills { display: flex; gap: 10px; margin-top: 15px; overflow-x: auto; padding-bottom: 5px; }
        .pill { background: #1e293b; padding: 8px 16px; border-radius: 100px; font-size: 12px; cursor: pointer; border: 1px solid var(--border); white-space: nowrap; }
        .pill.active { background: var(--primary); color: #000; font-weight: 700; }

        /* KPI Cards */
        .kpi-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 15px; }
        .kpi { background: var(--card); padding: 18px; border-radius: 20px; border: 1px solid var(--border); }
        .kpi span { font-size: 10px; color: var(--sub); text-transform: uppercase; font-weight: 800; }
        .kpi h2 { margin: 8px 0 0; font-size: 18px; font-weight: 800; }

        /* Charts */
        .grid-main { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media(min-width: 1024px) { .grid-main { grid-template-columns: 2fr 1fr; } }
        .box { background: var(--card); border-radius: 24px; padding: 20px; border: 1px solid var(--border); }

        /* Intelligent Table */
        .table-container { overflow-x: auto; margin-top: 15px; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { text-align: left; padding: 12px; color: var(--sub); font-size: 11px; text-transform: uppercase; border-bottom: 1px solid var(--border); }
        td { padding: 14px 12px; border-bottom: 1px solid var(--border); font-size: 13px; }

        .btn-float { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: #000; width: 56px; height: 56px; border-radius: 28px; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 10px 25px rgba(56, 189, 248, 0.4); border: none; cursor: pointer; z-index: 1000; }
        .blur { filter: blur(8px); }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h1 style="margin:0; font-size:22px;">Wealth <span style="color:var(--primary)">Pulse v14</span></h1>
            <button onclick="document.body.classList.toggle('blur-mode')" class="pill">üëÅÔ∏è Sigilo</button>
        </div>
        <div class="nav-pills" id="setorNav">
            <div class="pill active" onclick="filterData('TODOS')">Todos Ativos</div>
            <div class="pill" onclick="filterData('RENDA FIXA')">Renda Fixa</div>
            <div class="pill" onclick="filterData('ACAO')">A√ß√µes</div>
            <div class="pill" onclick="filterData('FII')">FIIs</div>
            <div class="pill" onclick="filterData('CRIPTO')">Criptos</div>
        </div>
    </div>

    <div class="kpi-row">
        <div class="kpi"><span>Patrim√¥nio</span><h2 id="kPat" class="val">R$ 0,00</h2></div>
        <div class="kpi"><span>Lucro Bruto</span><h2 id="kLuc" class="val" style="color:var(--success)">R$ 0,00</h2></div>
        <div class="kpi"><span>Rend. M√©dio</span><h2 id="kYld">0.00%</h2></div>
    </div>

    <div class="grid-main">
        <div class="box">
            <h3 style="margin:0 0 15px; font-size:14px;">Aloca√ß√£o de Ativos por Tipo</h3>
            <canvas id="cAloc" height="250"></canvas>
        </div>
        <div class="box">
            <h3 style="margin:0 0 15px; font-size:14px;">Diagn√≥stico IA</h3>
            <p id="aiText" style="font-size:13px; color:var(--sub); line-height:1.6;">Aguardando dados...</p>
        </div>
    </div>

    <div class="box" style="margin-top:15px;">
        <h3 style="margin:0 0 15px; font-size:14px;">Sua Carteira</h3>
        <div class="table-container">
            <table id="tAtivos">
                <thead>
                    <tr>
                        <th>Ativo</th>
                        <th>Tipo</th>
                        <th>Saldo Atual</th>
                        <th>Rentab.</th>
                        <th>Sugest√£o</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<label for="fIn" class="btn-float">Ôºã</label>
<input type="file" id="fIn" accept=".xlsx">

<script>
    let db = {}; let charts = {};
    const brl = v => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v || 0);

    window.onload = () => {
        const saved = localStorage.getItem('pulse_v14');
        if(saved) { db = JSON.parse(saved); updateUI('TODOS'); }
    };

    document.getElementById('fIn').addEventListener('change', e => {
        const reader = new FileReader();
        reader.onload = evt => {
            const wb = XLSX.read(evt.target.result, {type:'binary'});
            db = {
                c: XLSX.utils.sheet_to_json(wb.Sheets["CARTEIRA"]),
                d: XLSX.utils.sheet_to_json(wb.Sheets["DIVIDENDOS"])
            };
            localStorage.setItem('pulse_v14', JSON.stringify(db));
            updateUI('TODOS');
        };
        reader.readAsBinaryString(e.target.files[0]);
    });

    function updateUI(filter) {
        if(!db.c) return;
        const cart = db.c.filter(at => filter === 'TODOS' ? true : at.TIPO === filter);
        const totalPat = cart.reduce((a,b) => a + (parseFloat(b['CART. ATUAL'])||0), 0);
        const totalInv = cart.reduce((a,b) => a + (parseFloat(b['CUSTO TOTAL'])||0), 0);
        
        document.getElementById('kPat').innerText = brl(totalPat);
        document.getElementById('kLuc').innerText = brl(totalPat - totalInv);
        document.getElementById('kYld').innerText = (((totalPat/totalInv)-1)*100).toFixed(2) + "%";

        renderTable(cart);
        renderCharts(db.c);
        generateAIInsight(cart, totalPat);
    }

    function renderTable(cart) {
        const tb = document.querySelector('#tAtivos tbody');
        tb.innerHTML = '';
        cart.forEach(at => {
            const rent = (((at['CART. ATUAL']/at['CUSTO TOTAL'])-1)*100).toFixed(1);
            tb.innerHTML += `<tr>
                <td><b>${at.ATIVO}</b></td>
                <td><span class="pill" style="font-size:9px">${at.TIPO}</span></td>
                <td class="val">${brl(at['CART. ATUAL'])}</td>
                <td style="color:${rent >= 0 ? 'var(--success)' : 'var(--danger)'}">${rent}%</td>
                <td>${rent < -5 ? '‚ö° OPORTUNIDADE' : '‚úÖ MANTER'}</td>
            </tr>`;
        });
    }

    function renderCharts(all) {
        const tipos = {}; all.forEach(a => tipos[a.TIPO] = (tipos[a.TIPO] || 0) + (parseFloat(a['CART. ATUAL'])||0));
        if(charts.c) charts.c.destroy();
        charts.c = new Chart(document.getElementById('cAloc'), {
            type: 'bar',
            data: { labels: Object.keys(tipos), datasets: [{ data: Object.values(tipos), backgroundColor: '#38bdf8' }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
        });
    }

    function generateAIInsight(cart, total) {
        const top = cart.sort((a,b) => b['CART. ATUAL'] - a['CART. ATUAL'])[0];
        document.getElementById('aiText').innerText = `Seu maior ativo hoje √© ${top.ATIVO}, representando ${((top['CART. ATUAL']/total)*100).toFixed(1)}% da sua aloca√ß√£o atual. Para proteger seu capital, considere nunca ultrapassar 20% em um √∫nico ativo de risco.`;
    }

    function filterData(f) {
        document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
        event.target.classList.add('active');
        updateUI(f);
    }
</script>
<style>
    .blur-mode .val { filter: blur(8px); }
</style>
</body>
</html>
